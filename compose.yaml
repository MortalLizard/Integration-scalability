services:
    marketplace:
        build:
            context: .
            dockerfile: Marketplace/Dockerfile
        networks:
            - default
            - marketplace-network
        ports:
            - "8080:8080"
        environment:
            - ASPNETCORE_URLS=http://+:8080
            - ASPNETCORE_ENVIRONMENT=Development
            - ConnectionStrings__Default=Server=marketplace-db;Database=marketplace;User Id=sa;Password=Marketplace@123;TrustServerCertificate=True;
        depends_on:
            - marketplace-db

    inventory:
        build:
            context: .
            dockerfile: Inventory/Dockerfile
        networks:
            - default
            - inventory-network
        ports:
            - "8081:8081"
        environment:
            - ASPNETCORE_URLS=http://+:8081
            - ASPNETCORE_ENVIRONMENT=Development
            - ConnectionStrings__Default=Server=inventory-db;Database=inventory;User Id=sa;Password=Inventory@123;TrustServerCertificate=True;
        depends_on:
            - inventory-db

    billing:
        build:
            context: .
            dockerfile: Billing/Dockerfile
        networks:
            - default
            - billing-network
        ports:
            - "8082:8082"
        environment:
            - ASPNETCORE_URLS=http://+:8082
            - ASPNETCORE_ENVIRONMENT=Development
            - ConnectionStrings__Default=Server=billing-db;Database=billing;User Id=sa;Password=Billing@123;TrustServerCertificate=True;
        depends_on:
            - billing-db

    marketplace-db:
        image: mcr.microsoft.com/mssql/server:2019-latest
        container_name: marketplace-db
        restart: unless-stopped
        environment:
            ACCEPT_EULA: "Y"
            MSSQL_SA_PASSWORD: "Marketplace@123"
        networks:
            - default
            - marketplace-network
        ports:
            - "14333:1433"
        volumes:
            - marketplace_sql_data:/var/opt/mssql

    billing-db:
        image: mcr.microsoft.com/mssql/server:2019-latest
        container_name: billing-db
        restart: unless-stopped
        environment:
            ACCEPT_EULA: "Y"
            MSSQL_SA_PASSWORD: "Billing@123"
            MSSQL_PID: "Developer"
        networks:
            - default
            - billing-network
        ports:
            - "14334:1433"
        volumes:
            - billing_sql_data:/var/opt/mssql

    inventory-db:
        image: mcr.microsoft.com/mssql/server:2019-latest
        container_name: inventory-db
        restart: unless-stopped
        environment:
            ACCEPT_EULA: "Y"
            MSSQL_SA_PASSWORD: "Inventory@123"
        networks:
            - default
            - inventory-network
        ports:
            - "14335:1433"
        volumes:
            - inventory_sql_data:/var/opt/mssql

volumes:
    marketplace_sql_data:
    billing_sql_data:
    inventory_sql_data:
    search_data:
    elastic_data:

networks:
    marketplace-network:
    inventory-network:
    billing-network:
    search-network:
    default:
